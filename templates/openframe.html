<html>

<head>
    <title>Openframe</title>
    <link rel="stylesheet" type="text/css" href="/static/css/style.css">
</head>

<body>
    <div class="wrap">
        <div class="selects">
            <select id="AddingUser">
                <option value="jonwohl">@jonwohl</option>
                <option value="ishback">@ishback</option>
                <option value="anotheruser">@anotheruser</option>
            </select>
        </div>
        <div class="line"></div>
        <div class="enterArt">
            <form id="formEnterArt" method="post" action="/content" enctype="multipart/form-data">
                <input id="url" type="text" placeholder="Paste file URL" />
                <!-- <input type="file" name="filePath" value="Browse"> -->
                <input id="submit_button" type="submit" value="Add to Collection">
            </form>
        </div>
        <div class="line"></div>
        <div class="selects">
            <select id="DisplayingUser">
                <option value="jonwohl">@jonwohl</option>
                <option value="ishback">@ishback</option>
                <option value="anotheruser">@anotheruser</option>
            </select>
        </div>
        <div id="Art">
        </div>
    </div>

    <script type="text/template" id="ContentItemTemplate">
        <div class="content-item">
            <div class="thumb">
                <img class="thumb-img" src="#">
            </div>
            <div class="send-button">
                <a href="#" rel="#content_id">Send to Frame</a>
            </div>
        </div>
    </script>


    <script type="text/javascript" src="/static/js/libs/jquery-2.1.3.js"></script>
    <script type="text/javascript">
    $(function() {

        $("#formEnterArt").on('submit', function() {
            $.ajax({
                url: '/content',
                method: 'POST',
                data: JSON.stringify({
                    url: $('#url').val(),
                    username: $('#AddingUser').val()
                }),
                dataType: 'json'
            }).done(function(resp) {
                console.log(resp);
                fetchContent();
            });
            return false;
        });

        $(document).on('click', '.send-button', function(e) {
        	e.preventDefault();
        	var $el = $(e.target),
        		content_id = $el.attr('rel'),
        		user = $("#DisplayingUser").val();
        	
        	console.log('clicked', user, content_id);

        	$.getJSON('/update/' + user + '/' + content_id)
        		.done(function(resp) {
        			console.log(resp);
        		})
        });

        function fetchContent() {
            var user = $("#DisplayingUser").val();
            $.getJSON('/user/content/' + user)
                .done(function(content_list) {
                	console.log(content_list);
                    var $template = $($("#ContentItemTemplate").html()),
                        $art = $("#Art");
                    
                    $art.empty();
                    
                    for (var i = 0; i < content_list.length; i++) {
                        var $item_template = $template.clone();
                        $item_template.find(".thumb-img").attr('src', content_list[i].url);
                        $item_template.find(".send-button a").attr('rel', content_list[i]._id.$oid);
                        $art.append($item_template.html());
                    };
                });
        }



        fetchContent();
    });
    </script>
    
</body>

</html>
